{"version":3,"file":"absintheEventNames.js","sources":["../../src/notifier/cancel.js","../../src/notifier/observer/notifyAll.js","../../src/notifier/notifyCanceled.js","../../src/notifier/event/eventNames.js","../../src/notifier/event/eventCreators.js","../../src/notifier/flushCanceled.js","../../src/notifier/findIndex.js","../../src/notifier/refresh.js","../../src/notifier/remove.js","../../src/updateNotifiers.js","../../src/refreshNotifier.js","../../src/notifier/requestStatuses.js","../../src/notifier/notify.js","../../src/abortNotifier.js","../../src/notifier/find.js","../../src/notifier/notifyActive.js","../../src/notifier/notifyResultEvent.js","../../src/notifier/notifyStartEvent.js","../../src/notifier/reset.js","../../src/handlePush.js","../../src/pushAbsintheEvent.js","../../src/absinthe-event/absintheEventNames.js","../../src/absinthe-event/absintheEventCreators.js","../../src/pushRequestUsing.js","../../src/subscription.js","../../src/cancel.js","../../src/pushRequest.js","../../src/joinChannel.js","../../src/create.js","../../src/notifier/observe.js","../../src/observe.js","../../src/notifier/create.js","../../src/notifier/reactivate.js","../../src/send.js","../../src/toObservable.js","../../src/notifier/unobserve.js","../../src/unobserve.js","../../src/unobserveOrCancel.js"],"sourcesContent":["// @flow\n\nimport type {Notifier} from \"./types\";\n\nconst cancel = <Result, Variables: void | Object>({\n  activeObservers,\n  canceledObservers,\n  ...rest\n}: Notifier<Result, Variables>) => ({\n  ...rest,\n  isActive: false,\n  activeObservers: [],\n  canceledObservers: [...activeObservers, ...canceledObservers]\n});\n\nexport default cancel;\n","// @flow\n\nimport type {Event, Observer} from \"../types\";\n\nconst getNotifier = (handlerName, payload) => observer =>\n  observer[handlerName] && observer[handlerName](payload);\n\nconst getHandlerName = ({name}) => `on${name}`;\n\nconst notifyAll = <Result, Variables: void | Object>(\n  observers: $ReadOnlyArray<Observer<Result, Variables>>,\n  event: Event\n) => observers.forEach(getNotifier(getHandlerName(event), event.payload));\n\nexport default notifyAll;\n","// @flow\n\nimport observerNotifyAll from \"./observer/notifyAll\";\n\nimport type {Event, Notifier} from \"./types\";\n\nconst notifyCanceled = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  event: Event\n) => {\n  observerNotifyAll(notifier.canceledObservers, event);\n\n  return notifier;\n};\n\nexport default notifyCanceled;\n","// @flow\n\nconst eventNames = {\n  abort: (\"Abort\": \"Abort\"),\n  cancel: (\"Cancel\": \"Cancel\"),\n  error: (\"Error\": \"Error\"),\n  result: (\"Result\": \"Result\"),\n  start: (\"Start\": \"Start\")\n};\n\ntype EventName = $Values<typeof eventNames>;\n\nexport default eventNames;\n\nexport type {EventName};\n","// @flow\n\nimport eventNames from \"./eventNames\";\n\nimport type {\n  AbortEvent,\n  CancelEvent,\n  ErrorEvent,\n  Notifier,\n  ResultEvent,\n  StartEvent\n} from \"../types\";\n\nconst createStartEvent = <Payload: Notifier<any, any>>(\n  payload: Payload\n): StartEvent<Payload> => ({payload, name: eventNames.start});\n\nconst createResultEvent = <Result>(payload: Result): ResultEvent<Result> => ({\n  payload,\n  name: eventNames.result\n});\n\nconst createErrorEvent = (payload: Error): ErrorEvent => ({\n  payload,\n  name: eventNames.error\n});\n\nconst createCancelEvent = (): CancelEvent => ({\n  name: eventNames.cancel,\n  payload: undefined\n});\n\nconst createAbortEvent = (payload: Error): AbortEvent => ({\n  payload,\n  name: eventNames.abort\n});\n\nexport {\n  createStartEvent,\n  createResultEvent,\n  createErrorEvent,\n  createCancelEvent,\n  createAbortEvent\n};\n","// @flow\n\nimport notifyCanceled from \"./notifyCanceled\";\nimport {createCancelEvent} from \"./event/eventCreators\";\n\nimport type {Notifier} from \"./types\";\n\nconst clearCanceled = notifier => ({\n  ...notifier,\n  canceledObservers: []\n});\n\nconst flushCanceled = <Result: any, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) =>\n  notifier.canceledObservers.length > 0\n    ? clearCanceled(notifyCanceled(notifier, createCancelEvent()))\n    : notifier;\n\nexport default flushCanceled;\n","// @flow\n\nimport {hasIn} from \"@jumpn/utils-composite\";\n\nimport type {Notifier} from \"./types\";\n\nconst findIndex = (\n  notifiers: Array<Notifier<any, any>>,\n  key: string,\n  value: any\n) =>\n  // $FlowFixMe: flow is having some troubles to match hasIn signature (curry)\n  notifiers.findIndex(hasIn([key], value));\n\nexport default findIndex;\n","// @flow\n\nimport {replace as arrayReplace} from \"@jumpn/utils-array\";\n\nimport findIndex from \"./findIndex\";\n\nimport type {Notifier} from \"./types\";\n\nconst refresh = (notifier: Notifier<any, any>) => (\n  notifiers: Array<Notifier<any, any>>\n) =>\n  arrayReplace(\n    findIndex(notifiers, \"request\", notifier.request),\n    [notifier],\n    notifiers\n  );\n\nexport default refresh;\n","// @flow\n\nimport {remove as arrayRemove} from \"@jumpn/utils-array\";\n\nimport findIndex from \"./findIndex\";\n\nimport type {Notifier} from \"./types\";\n\nconst remove = (notifier: Notifier<any, any>) => (\n  notifiers: Array<Notifier<any, any>>\n) =>\n  arrayRemove(findIndex(notifiers, \"request\", notifier.request), 1, notifiers);\n\nexport default remove;\n","// @flow\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\ntype Notifiers = Array<Notifier<any, any>>;\n\nconst updateNotifiers = (\n  absintheSocket: AbsintheSocket,\n  updater: (notifiers: Notifiers) => Notifiers\n) => {\n  absintheSocket.notifiers = updater(absintheSocket.notifiers);\n\n  return absintheSocket;\n};\n\nexport default updateNotifiers;\n","// @flow\n\nimport notifierRefresh from \"./notifier/refresh\";\nimport updateNotifiers from \"./updateNotifiers\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst refreshNotifier = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>\n) => {\n  updateNotifiers(absintheSocket, notifierRefresh(notifier));\n\n  return notifier;\n};\n\nexport default refreshNotifier;\n","// @flow\n\nconst requestStatuses = {\n  canceled: (\"canceled\": \"canceled\"),\n  canceling: (\"canceling\": \"canceling\"),\n  pending: (\"pending\": \"pending\"),\n  sent: (\"sent\": \"sent\"),\n  sending: (\"sending\": \"sending\")\n};\n\ntype RequestStatus = $Values<typeof requestStatuses>;\n\nexport default requestStatuses;\n\nexport type {RequestStatus};\n","// @flow\n\nimport observerNotifyAll from \"./observer/notifyAll\";\n\nimport type {Event, Notifier} from \"./types\";\n\nconst getObservers = ({activeObservers, canceledObservers}) => [\n  ...activeObservers,\n  ...canceledObservers\n];\n\nconst notify = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  event: Event\n) => {\n  observerNotifyAll(getObservers(notifier), event);\n\n  return notifier;\n};\n\nexport default notify;\n","// @flow\n\nimport notifierNotify from \"./notifier/notify\";\nimport notifierRemove from \"./notifier/remove\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {createAbortEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst abortNotifier = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  error: Error\n) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifierNotify(notifier, createAbortEvent(error)))\n  );\n\nexport default abortNotifier;\n","// @flow\n\nimport {hasIn} from \"@jumpn/utils-composite\";\n\nimport type {Notifier} from \"./types\";\n\nconst find = (notifiers: Array<Notifier<any, any>>, key: string, value: any) =>\n  // $FlowFixMe: flow is having some troubles to match hasIn signature (curry)\n  notifiers.find(hasIn([key], value));\n\nexport default find;\n","// @flow\n\nimport observerNotifyAll from \"./observer/notifyAll\";\n\nimport type {Event, Notifier} from \"./types\";\n\nconst notifyActive = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  event: Event\n) => {\n  observerNotifyAll(notifier.activeObservers, event);\n\n  return notifier;\n};\n\nexport default notifyActive;\n","// @flow\n\nimport notifyActive from \"./notifyActive\";\nimport {createResultEvent} from \"./event/eventCreators\";\n\nimport type {Notifier} from \"./types\";\n\nconst notifyResultEvent = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>,\n  result: Result\n) => notifyActive(notifier, createResultEvent(result));\n\nexport default notifyResultEvent;\n","// @flow\n\nimport notifyActive from \"./notifyActive\";\nimport {createStartEvent} from \"./event/eventCreators\";\n\nimport type {Notifier} from \"./types\";\n\nconst notifyStartEvent = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) => notifyActive(notifier, createStartEvent(notifier));\n\nexport default notifyStartEvent;\n","// @flow\n\nimport flushCanceled from \"./flushCanceled\";\nimport requestStatuses from \"./requestStatuses\";\n\nimport type {Notifier} from \"./types\";\n\nconst reset = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) =>\n  flushCanceled({\n    ...notifier,\n    isActive: true,\n    requestStatus: requestStatuses.pending,\n    subscriptionId: undefined\n  });\n\nexport default reset;\n","// @flow\n\nimport {Push} from \"phoenix\";\n\nimport type {PushHandler} from \"./types\";\n\nconst handlePush = (push: Push, handler: PushHandler<any>) =>\n  push\n    .receive(\"ok\", handler.onSucceed)\n    .receive(\"error\", handler.onError)\n    .receive(\"timeout\", handler.onTimeout);\n\nexport default handlePush;\n","// @flow\n\nimport {map} from \"@jumpn/utils-composite\";\n\nimport type {GqlRequest} from \"@jumpn/utils-graphql/compat/cjs/types\";\n\nimport handlePush from \"./handlePush\";\nimport notifierFind from \"./notifier/find\";\n\nimport type {AbsintheEvent} from \"./absinthe-event/types\";\nimport type {AbsintheSocket, NotifierPushHandler} from \"./types\";\n\nconst getPushHandlerMethodGetter = (absintheSocket, request) => handle => (\n  ...args\n) => {\n  const notifier = notifierFind(absintheSocket.notifiers, \"request\", request);\n\n  if (notifier) {\n    handle(absintheSocket, notifier, ...args);\n  }\n};\n\nconst getPushHandler = (absintheSocket, request, notifierPushHandler) =>\n  map(getPushHandlerMethodGetter(absintheSocket, request), notifierPushHandler);\n\nconst pushAbsintheEvent = <Variables: void | Object, Response: Object>(\n  absintheSocket: AbsintheSocket,\n  request: GqlRequest<Variables>,\n  notifierPushHandler: NotifierPushHandler<Response>,\n  absintheEvent: AbsintheEvent\n) => {\n  handlePush(\n    absintheSocket.channel.push(absintheEvent.name, absintheEvent.payload),\n    getPushHandler(absintheSocket, request, notifierPushHandler)\n  );\n\n  return absintheSocket;\n};\n\nexport default pushAbsintheEvent;\n","// @flow\n\nconst absintheEventNames = {\n  doc: (\"doc\": \"doc\"),\n  unsubscribe: (\"unsubscribe\": \"unsubscribe\")\n};\n\ntype AbsintheEventName = $Values<typeof absintheEventNames>;\n\nexport default absintheEventNames;\n\nexport type {AbsintheEventName};\n","// @flow\n\nimport absintheEventNames from \"./absintheEventNames\";\n\nimport type {AbsintheDocEvent, AbsintheUnsubscribeEvent} from \"./types\";\n\nconst createAbsintheUnsubscribeEvent = (\n  payload: $ElementType<AbsintheUnsubscribeEvent, \"payload\">\n): AbsintheUnsubscribeEvent => ({\n  payload,\n  name: absintheEventNames.unsubscribe\n});\n\nconst createAbsintheDocEvent = <Variables: void | Object>(\n  payload: $ElementType<AbsintheDocEvent<Variables>, \"payload\">\n): AbsintheDocEvent<Variables> => ({\n  payload,\n  name: absintheEventNames.doc\n});\n\nexport {createAbsintheDocEvent, createAbsintheUnsubscribeEvent};\n","// @flow\n\nimport {requestToCompat} from \"@jumpn/utils-graphql\";\n\nimport abortNotifier from \"./abortNotifier\";\nimport notifierNotifyActive from \"./notifier/notifyActive\";\nimport pushAbsintheEvent from \"./pushAbsintheEvent\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport {createAbsintheDocEvent} from \"./absinthe-event/absintheEventCreators\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket, NotifierPushHandler} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst pushAbsintheDocEvent = (absintheSocket, {request}, notifierPushHandler) =>\n  pushAbsintheEvent(\n    absintheSocket,\n    request,\n    notifierPushHandler,\n    createAbsintheDocEvent(requestToCompat(request))\n  );\n\nconst setNotifierRequestStatusSending = (absintheSocket, notifier) =>\n  refreshNotifier(absintheSocket, {\n    ...notifier,\n    requestStatus: requestStatuses.sending\n  });\n\nconst createRequestError = message => {\n  const error = new Error(`request: ${JSON.stringify(message)}`);\n  error.object = message;\n\n  return error;\n};\n\nconst onTimeout = (absintheSocket, notifier) =>\n  notifierNotifyActive(\n    notifier,\n    createErrorEvent(createRequestError(\"timeout\"))\n  );\n\nconst onError = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  errorMessage: string\n) => abortNotifier(absintheSocket, notifier, createRequestError(errorMessage));\n\nconst getNotifierPushHandler = onSucceed => ({onError, onSucceed, onTimeout});\n\nconst pushRequestUsing = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  onSucceed: $ElementType<NotifierPushHandler<any>, \"onSucceed\">\n) =>\n  pushAbsintheDocEvent(\n    absintheSocket,\n    setNotifierRequestStatusSending(absintheSocket, notifier),\n    getNotifierPushHandler(onSucceed)\n  );\n\nexport {pushRequestUsing as default, onError};\n","// @flow\n\nimport {errorsToString as gqlErrorsToString} from \"@jumpn/utils-graphql\";\n\nimport type {\n  GqlError,\n  GqlResponse\n} from \"@jumpn/utils-graphql/compat/cjs/types\";\nimport type {Message} from \"phoenix\";\n\nimport abortNotifier from \"./abortNotifier\";\nimport notifierFind from \"./notifier/find\";\nimport notifierFlushCanceled from \"./notifier/flushCanceled\";\nimport notifierNotifyCanceled from \"./notifier/notifyCanceled\";\nimport notifierNotifyResultEvent from \"./notifier/notifyResultEvent\";\nimport notifierNotifyStartEvent from \"./notifier/notifyStartEvent\";\nimport notifierRemove from \"./notifier/remove\";\nimport notifierReset from \"./notifier/reset\";\nimport pushAbsintheEvent from \"./pushAbsintheEvent\";\nimport pushRequestUsing, {onError} from \"./pushRequestUsing\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {createAbsintheUnsubscribeEvent} from \"./absinthe-event/absintheEventCreators\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket, NotifierPushHandler} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\ntype SubscriptionPayload<Data> = {|\n  result: GqlResponse<Data>,\n  subscriptionId: string\n|};\n\n// TODO: improve this type\ntype UnsubscribeResponse = {};\n\ntype SubscriptionResponse =\n  | {|subscriptionId: string|}\n  | {|errors: Array<GqlError>|};\n\nconst onUnsubscribeSucceedCanceled = (absintheSocket, notifier) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifierFlushCanceled(notifier))\n  );\n\nconst onUnsubscribeSucceedActive = (absintheSocket, notifier) =>\n  subscribe(\n    absintheSocket,\n    refreshNotifier(absintheSocket, notifierReset(notifier))\n  );\n\nconst createUnsubscribeError = message => new Error(`unsubscribe: ${message}`);\n\nconst unsubscribeHandler: NotifierPushHandler<UnsubscribeResponse> = {\n  onError: (absintheSocket, notifier, errorMessage) =>\n    abortNotifier(\n      absintheSocket,\n      notifier,\n      createUnsubscribeError(errorMessage)\n    ),\n\n  onTimeout: (absintheSocket, notifier) =>\n    notifierNotifyCanceled(\n      notifier,\n      createErrorEvent(createUnsubscribeError(\"timeout\"))\n    ),\n\n  onSucceed: (absintheSocket, notifier) => {\n    if (notifier.isActive) {\n      onUnsubscribeSucceedActive(absintheSocket, notifier);\n    } else {\n      onUnsubscribeSucceedCanceled(absintheSocket, notifier);\n    }\n  }\n};\n\nconst pushAbsintheUnsubscribeEvent = (\n  absintheSocket,\n  {request, subscriptionId}\n) =>\n  pushAbsintheEvent(\n    absintheSocket,\n    request,\n    unsubscribeHandler,\n    createAbsintheUnsubscribeEvent({subscriptionId})\n  );\n\nconst unsubscribe = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>\n) =>\n  pushAbsintheUnsubscribeEvent(\n    absintheSocket,\n    refreshNotifier(absintheSocket, {\n      ...notifier,\n      requestStatus: requestStatuses.canceling\n    })\n  );\n\nconst onSubscribeSucceed = (absintheSocket, notifier, {subscriptionId}) => {\n  const subscribedNotifier = refreshNotifier(absintheSocket, {\n    ...notifier,\n    subscriptionId,\n    requestStatus: requestStatuses.sent\n  });\n\n  if (subscribedNotifier.isActive) {\n    notifierNotifyStartEvent(subscribedNotifier);\n  } else {\n    unsubscribe(absintheSocket, subscribedNotifier);\n  }\n};\n\nconst onSubscribe = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  response: SubscriptionResponse\n) => {\n  if (response.errors) {\n    onError(absintheSocket, notifier, gqlErrorsToString(response.errors));\n  } else {\n    onSubscribeSucceed(absintheSocket, notifier, response);\n  }\n};\n\nconst subscribe = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>\n) => pushRequestUsing(absintheSocket, notifier, onSubscribe);\n\nconst onDataMessage = (\n  absintheSocket: AbsintheSocket,\n  {payload}: Message<SubscriptionPayload<any>>\n) => {\n  const notifier = notifierFind(\n    absintheSocket.notifiers,\n    \"subscriptionId\",\n    payload.subscriptionId\n  );\n\n  if (notifier) {\n    notifierNotifyResultEvent(notifier, payload.result);\n  }\n};\n\nconst dataMessageEventName = \"subscription:data\";\n\nconst isDataMessage = (message: Message<>) =>\n  message.event === dataMessageEventName;\n\nexport {isDataMessage, onDataMessage, subscribe, unsubscribe};\n\nexport type {SubscriptionPayload};\n","// @flow\n\nimport notifierCancel from \"./notifier/cancel\";\nimport notifierFlushCanceled from \"./notifier/flushCanceled\";\nimport notifierRefresh from \"./notifier/refresh\";\nimport notifierRemove from \"./notifier/remove\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {unsubscribe} from \"./subscription\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst cancelQueryOrMutationSending = (absintheSocket, notifier) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRefresh(notifierFlushCanceled(notifierCancel(notifier)))\n  );\n\nconst cancelQueryOrMutationIfSending = (absintheSocket, notifier) =>\n  notifier.requestStatus === requestStatuses.sending\n    ? cancelQueryOrMutationSending(absintheSocket, notifier)\n    : absintheSocket;\n\nconst cancelPending = (absintheSocket, notifier) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifierFlushCanceled(notifierCancel(notifier)))\n  );\n\nconst cancelQueryOrMutation = (absintheSocket, notifier) =>\n  notifier.requestStatus === requestStatuses.pending\n    ? cancelPending(absintheSocket, notifier)\n    : cancelQueryOrMutationIfSending(absintheSocket, notifier);\n\nconst unsubscribeIfNeeded = (absintheSocket, notifier) =>\n  notifier.requestStatus === requestStatuses.sent\n    ? unsubscribe(absintheSocket, notifier)\n    : absintheSocket;\n\nconst cancelNonPendingSubscription = (absintheSocket, notifier) =>\n  unsubscribeIfNeeded(\n    absintheSocket,\n    refreshNotifier(absintheSocket, notifierCancel(notifier))\n  );\n\nconst cancelSubscription = (absintheSocket, notifier) =>\n  notifier.requestStatus === requestStatuses.pending\n    ? cancelPending(absintheSocket, notifier)\n    : cancelNonPendingSubscription(absintheSocket, notifier);\n\nconst cancelActive = (absintheSocket, notifier) =>\n  notifier.operationType === \"subscription\"\n    ? cancelSubscription(absintheSocket, notifier)\n    : cancelQueryOrMutation(absintheSocket, notifier);\n\n/**\n * Cancels a notifier sending a Cancel event to all its observers and\n * unsubscribing in case it holds a subscription request\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n *\n * withAbsintheSocket.cancel(absintheSocket, notifier);\n */\nconst cancel = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>\n): AbsintheSocket =>\n  notifier.isActive ? cancelActive(absintheSocket, notifier) : absintheSocket;\n\nexport default cancel;\n","// @flow\n\nimport type {GqlResponse} from \"@jumpn/utils-graphql/compat/cjs/types\";\n\nimport notifierNotifyResultEvent from \"./notifier/notifyResultEvent\";\nimport notifierNotifyStartEvent from \"./notifier/notifyStartEvent\";\nimport notifierRemove from \"./notifier/remove\";\nimport pushRequestUsing from \"./pushRequestUsing\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport {subscribe} from \"./subscription\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst setNotifierRequestStatusSent = (absintheSocket, notifier) =>\n  refreshNotifier(absintheSocket, {\n    ...notifier,\n    requestStatus: requestStatuses.sent\n  });\n\nconst onQueryOrMutationSucceed = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  response: GqlResponse<any>\n) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(\n      notifierNotifyResultEvent(\n        setNotifierRequestStatusSent(absintheSocket, notifier),\n        response\n      )\n    )\n  );\n\nconst pushQueryOrMutation = (absintheSocket, notifier) =>\n  pushRequestUsing(\n    absintheSocket,\n    notifierNotifyStartEvent(notifier),\n    onQueryOrMutationSucceed\n  );\n\nconst pushRequest = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>\n) => {\n  if (notifier.operationType === \"subscription\") {\n    subscribe(absintheSocket, notifier);\n  } else {\n    pushQueryOrMutation(absintheSocket, notifier);\n  }\n};\n\nexport default pushRequest;\n","// @flow\n\nimport handlePush from \"./handlePush\";\nimport notifierNotifyActive from \"./notifier/notifyActive\";\nimport pushRequest from \"./pushRequest\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket} from \"./types\";\n\nconst createChannelJoinError = message => new Error(`channel join: ${message}`);\n\nconst notifyErrorToAllActive = (absintheSocket, errorMessage) =>\n  absintheSocket.notifiers.forEach(notifier =>\n    notifierNotifyActive(\n      notifier,\n      createErrorEvent(createChannelJoinError(errorMessage))\n    )\n  );\n\n// join Push is reused and so the handler\n// https://github.com/phoenixframework/phoenix/blob/master/assets/js/phoenix.js#L356\nconst createChannelJoinHandler = absintheSocket => ({\n  onError: (errorMessage: string) =>\n    notifyErrorToAllActive(absintheSocket, errorMessage),\n\n  onSucceed: () =>\n    absintheSocket.notifiers.forEach(notifier =>\n      pushRequest(absintheSocket, notifier)\n    ),\n\n  onTimeout: () => notifyErrorToAllActive(absintheSocket, \"timeout\")\n});\n\nconst joinChannel = (absintheSocket: AbsintheSocket) => {\n  handlePush(\n    absintheSocket.channel.join(),\n    createChannelJoinHandler(absintheSocket)\n  );\n\n  absintheSocket.channelJoinCreated = true;\n\n  return absintheSocket;\n};\n\nexport default joinChannel;\n","// @flow\n\nimport {Socket as PhoenixSocket} from \"phoenix\";\n\nimport type {Message} from \"phoenix\";\n\nimport abortNotifier from \"./abortNotifier\";\nimport joinChannel from \"./joinChannel\";\nimport notifierNotify from \"./notifier/notify\";\nimport notifierRemove from \"./notifier/remove\";\nimport notifierReset from \"./notifier/reset\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport updateNotifiers from \"./updateNotifiers\";\nimport * as withSubscription from \"./subscription\";\nimport {createErrorEvent} from \"./notifier/event/eventCreators\";\n\nimport type {AbsintheSocket} from \"./types\";\n\nconst onMessage = absintheSocket => (message: Message<>) => {\n  if (withSubscription.isDataMessage(message)) {\n    withSubscription.onDataMessage(absintheSocket, message);\n  }\n};\n\nconst createConnectionCloseError = () => new Error(\"connection: close\");\n\nconst notifyConnectionCloseError = notifier =>\n  notifierNotify(notifier, createErrorEvent(createConnectionCloseError()));\n\nconst notifierOnConnectionCloseCanceled = (absintheSocket, notifier) =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRemove(notifyConnectionCloseError(notifier))\n  );\n\nconst notifierOnConnectionCloseActive = (absintheSocket, notifier) => {\n  if (notifier.operationType === \"mutation\") {\n    abortNotifier(absintheSocket, notifier, createConnectionCloseError());\n  } else {\n    refreshNotifier(\n      absintheSocket,\n      notifierReset(notifyConnectionCloseError(notifier))\n    );\n  }\n};\n\nconst notifierOnConnectionClose = absintheSocket => notifier => {\n  if (notifier.isActive) {\n    notifierOnConnectionCloseActive(absintheSocket, notifier);\n  } else {\n    notifierOnConnectionCloseCanceled(absintheSocket, notifier);\n  }\n};\n\nconst onConnectionClose = absintheSocket => () =>\n  absintheSocket.notifiers.forEach(notifierOnConnectionClose(absintheSocket));\n\nconst shouldJoinChannel = absintheSocket =>\n  !absintheSocket.channelJoinCreated && absintheSocket.notifiers.length > 0;\n\nconst onConnectionOpen = absintheSocket => () => {\n  if (shouldJoinChannel(absintheSocket)) {\n    joinChannel(absintheSocket);\n  }\n};\n\nconst absintheChannelName = \"__absinthe__:control\";\n\n/**\n * Creates an Absinthe Socket using the given Phoenix Socket instance\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n * import {Socket as PhoenixSocket} from \"phoenix\";\n\n * const absintheSocket = withAbsintheSocket.create(\n *   new PhoenixSocket(\"ws://localhost:4000/socket\")\n * );\n */\nconst create = (phoenixSocket: PhoenixSocket): AbsintheSocket => {\n  const absintheSocket: AbsintheSocket = {\n    phoenixSocket,\n    channel: phoenixSocket.channel(absintheChannelName),\n    channelJoinCreated: false,\n    notifiers: []\n  };\n\n  phoenixSocket.onOpen(onConnectionOpen(absintheSocket));\n  phoenixSocket.onClose(onConnectionClose(absintheSocket));\n  phoenixSocket.onMessage(onMessage(absintheSocket));\n\n  return absintheSocket;\n};\n\nexport default create;\n","// @flow\n\nimport type {Notifier, Observer} from \"./types\";\n\nconst observe = <Result, Variables: void | Object>(\n  {activeObservers, ...rest}: Notifier<Result, Variables>,\n  observer: Observer<Result, Variables>\n) => ({\n  ...rest,\n  activeObservers: [...activeObservers, observer],\n  isActive: true\n});\n\nexport default observe;\n","// @flow\n\nimport notifierObserve from \"./notifier/observe\";\nimport refreshNotifier from \"./refreshNotifier\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier, Observer} from \"./notifier/types\";\n\n/**\n * Observes given notifier using the provided observer\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\"\n *\n * const logEvent = eventName => (...args) => console.log(eventName, ...args);\n *\n * const updatedNotifier = withAbsintheSocket.observe(absintheSocket, notifier, {\n *   onAbort: logEvent(\"abort\"),\n *   onError: logEvent(\"error\"),\n *   onStart: logEvent(\"open\"),\n *   onResult: logEvent(\"result\")\n * });\n */\nconst observe = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>,\n  observer: Observer<Result, Variables>\n) => refreshNotifier(absintheSocket, notifierObserve(notifier, observer));\n\nexport default observe;\n","// @flow\n\nimport {getOperationType} from \"@jumpn/utils-graphql\";\n\nimport type {GqlRequest} from \"@jumpn/utils-graphql/compat/cjs/types\";\n\nimport requestStatuses from \"./requestStatuses\";\n\nimport type {Notifier} from \"./types\";\n\nconst createUsing = (request, operationType) => ({\n  operationType,\n  request,\n  activeObservers: [],\n  canceledObservers: [],\n  isActive: true,\n  requestStatus: requestStatuses.pending,\n  subscriptionId: undefined\n});\n\nconst create = <Variables: void | Object>(\n  request: GqlRequest<Variables>\n): Notifier<any, $Subtype<Variables>> =>\n  createUsing(request, getOperationType(request.operation));\n\nexport default create;\n","// @flow\n\nimport type {Notifier} from \"./types\";\n\nconst reactivate = <Result, Variables: void | Object>(\n  notifier: Notifier<Result, Variables>\n) => (notifier.isActive ? notifier : {...notifier, isActive: true});\n\nexport default reactivate;\n","// @flow\n\nimport {append} from \"@jumpn/utils-array\";\n\nimport type {GqlRequest} from \"@jumpn/utils-graphql/compat/cjs/types\";\n\nimport joinChannel from \"./joinChannel\";\nimport notifierCreate from \"./notifier/create\";\nimport notifierFind from \"./notifier/find\";\nimport notifierFlushCanceled from \"./notifier/flushCanceled\";\nimport notifierReactivate from \"./notifier/reactivate\";\nimport pushRequest from \"./pushRequest\";\nimport refreshNotifier from \"./refreshNotifier\";\nimport requestStatuses from \"./notifier/requestStatuses\";\nimport updateNotifiers from \"./updateNotifiers\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier} from \"./notifier/types\";\n\nconst connectOrJoinChannel = absintheSocket => {\n  if (absintheSocket.phoenixSocket.isConnected()) {\n    joinChannel(absintheSocket);\n  } else {\n    // socket ignores connect calls if a connection has already been created\n    absintheSocket.phoenixSocket.connect();\n  }\n};\n\nconst sendNew = (absintheSocket, request) => {\n  const notifier = notifierCreate(request);\n\n  updateNotifiers(absintheSocket, append([notifier]));\n\n  if (absintheSocket.channelJoinCreated) {\n    pushRequest(absintheSocket, notifier);\n  } else {\n    connectOrJoinChannel(absintheSocket);\n  }\n\n  return notifier;\n};\n\nconst updateCanceledReactivate = (absintheSocket, notifier) =>\n  refreshNotifier(absintheSocket, notifierReactivate(notifier));\n\nconst updateCanceled = (absintheSocket, notifier) =>\n  notifier.requestStatus === requestStatuses.sending\n    ? updateCanceledReactivate(absintheSocket, notifierFlushCanceled(notifier))\n    : updateCanceledReactivate(absintheSocket, notifier);\n\nconst updateIfCanceled = (absintheSocket, notifier) =>\n  notifier.isActive ? notifier : updateCanceled(absintheSocket, notifier);\n\nconst getExistentIfAny = (absintheSocket, request) => {\n  const notifier = notifierFind(absintheSocket.notifiers, \"request\", request);\n\n  return notifier && updateIfCanceled(absintheSocket, notifier);\n};\n\n/**\n * Sends given request and returns an object (notifier) to track its progress\n * (see observe function)\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n *\n * const operation = `\n *   subscription userSubscription($userId: ID!) {\n *     user(userId: $userId) {\n *       id\n *       name\n *     }\n *   }\n * `;\n *\n * // This example uses a subscription, but the functionallity is the same for\n * // all operation types (queries, mutations and subscriptions)\n *\n * const notifier = withAbsintheSocket.send(absintheSocket, {\n *   operation,\n *   variables: {userId: 10}\n * });\n */\nconst send = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  request: GqlRequest<Variables>\n): Notifier<Result, Variables> =>\n  getExistentIfAny(absintheSocket, request) || sendNew(absintheSocket, request);\n\nexport default send;\n","// @flow\n\nimport Observable from \"zen-observable\";\n\nimport notifierFind from \"./notifier/find\";\nimport observe from \"./observe\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier, Observer} from \"./notifier/types\";\n\ntype Options<Result, Variables: void | Object> = {|\n  onError: $ElementType<Observer<Result, Variables>, \"onError\">,\n  onStart: $ElementType<Observer<Result, Variables>, \"onStart\">,\n  unsubscribe: (\n    absintheSocket: AbsintheSocket,\n    notifier?: Notifier<Result, Variables>,\n    observer?: Observer<Result, Variables>\n  ) => void\n|};\n\n// prettier-ignore\nconst getUnsubscriber = (absintheSocket, {request}, observer, unsubscribe) =>\n  () => {\n    const notifier = notifierFind(absintheSocket.notifiers, \"request\", request);\n\n    unsubscribe(absintheSocket, notifier, notifier ? observer: undefined);\n  };\n\nconst onResult = ({operationType}, observableObserver) => result => {\n  observableObserver.next(result);\n\n  if (operationType !== \"subscription\") {\n    observableObserver.complete();\n  }\n};\n\nconst createObserver = (notifier, handlers, observableObserver) => ({\n  ...handlers,\n  onAbort: observableObserver.error.bind(observableObserver),\n  onResult: onResult(notifier, observableObserver)\n});\n\n/**\n * Creates an Observable that will follow the given notifier\n *\n * @param {AbsintheSocket} absintheSocket\n * @param {Notifier<Result, Variables>} notifier\n * @param {Object} [options]\n * @param {function(error: Error): undefined} [options.onError]\n * @param {function(notifier: Notifier<Result, Variables>): undefined} [options.onStart]\n * @param {function(): undefined} [options.unsubscribe]\n *\n * @return {Observable}\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n *\n * const unobserveOrCancelIfNeeded = (absintheSocket, notifier, observer) => {\n *   if (notifier && observer) {\n *     withAbsintheSocket.unobserveOrCancel(absintheSocket, notifier, observer);\n *   }\n * };\n *\n * const logEvent = eventName => (...args) => console.log(eventName, ...args);\n *\n * const observable = withAbsintheSocket.toObservable(absintheSocket, notifier, {\n *   onError: logEvent(\"error\"),\n *   onStart: logEvent(\"open\"),\n *   unsubscribe: unobserveOrCancelIfNeeded\n * });\n */\nconst toObservable = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>,\n  {unsubscribe, ...handlers}: $Shape<Options<Result, Variables>> = {}\n) =>\n  new Observable(observableObserver => {\n    const observer = createObserver(notifier, handlers, observableObserver);\n\n    observe(absintheSocket, notifier, observer);\n\n    return (\n      unsubscribe &&\n      getUnsubscriber(absintheSocket, notifier, observer, unsubscribe)\n    );\n  });\n\nexport default toObservable;\n","// @flow\n\nimport {remove as arrayRemove} from \"@jumpn/utils-array\";\n\nimport type {Notifier, Observer} from \"./types\";\n\nconst removeObserver = (observers, observer) =>\n  arrayRemove(observers.indexOf(observer), 1, observers);\n\nconst unobserve = <Result, Variables: void | Object>(\n  {activeObservers, ...rest}: Notifier<Result, Variables>,\n  observer: Observer<Result, Variables>\n) => ({\n  ...rest,\n  activeObservers: removeObserver(activeObservers, observer)\n});\n\nexport default unobserve;\n","// @flow\n\nimport notifierRefresh from \"./notifier/refresh\";\nimport notifierUnobserve from \"./notifier/unobserve\";\nimport updateNotifiers from \"./updateNotifiers\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier, Observer} from \"./notifier/types\";\n\nconst ensureHasActiveObserver = (notifier, observer) => {\n  if (notifier.activeObservers.includes(observer)) return notifier;\n\n  throw new Error(\"Observer is not attached to notifier\");\n};\n\n/**\n * Detaches observer from notifier\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n *\n * withAbsintheSocket.unobserve(absintheSocket, notifier, observer);\n */\nconst unobserve = (\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<any, any>,\n  observer: Observer<any, any>\n): AbsintheSocket =>\n  updateNotifiers(\n    absintheSocket,\n    notifierRefresh(\n      notifierUnobserve(ensureHasActiveObserver(notifier, observer), observer)\n    )\n  );\n\nexport default unobserve;\n","// @flow\n\nimport cancel from \"./cancel\";\nimport unobserve from \"./unobserve\";\n\nimport type {AbsintheSocket} from \"./types\";\nimport type {Notifier, Observer} from \"./notifier/types\";\n\nconst doUnobserveOrCancel = (absintheSocket, notifier, observer) =>\n  notifier.activeObservers.length === 1\n    ? cancel(absintheSocket, notifier)\n    : unobserve(absintheSocket, notifier, observer);\n\n/**\n * Cancels notifier if there are no more observers apart from the one given, or\n * detaches given observer from notifier otherwise\n *\n * @example\n * import * as withAbsintheSocket from \"@absinthe/socket\";\n *\n * withAbsintheSocket.unobserve(absintheSocket, notifier, observer);\n */\nconst unobserveOrCancel = <Result, Variables: void | Object>(\n  absintheSocket: AbsintheSocket,\n  notifier: Notifier<Result, Variables>,\n  observer: Observer<Result, Variables>\n) =>\n  notifier.isActive\n    ? doUnobserveOrCancel(absintheSocket, notifier, observer)\n    : absintheSocket;\n\nexport default unobserveOrCancel;\n"],"names":["cancel","activeObservers","canceledObservers","rest","isActive","getNotifier","handlerName","payload","observer","getHandlerName","name","notifyAll","observers","event","forEach","notifyCanceled","notifier","observerNotifyAll","eventNames","abort","error","result","start","createStartEvent","createResultEvent","createErrorEvent","createCancelEvent","undefined","createAbortEvent","clearCanceled","flushCanceled","length","findIndex","notifiers","key","value","hasIn","refresh","arrayReplace","request","remove","arrayRemove","updateNotifiers","absintheSocket","updater","refreshNotifier","notifierRefresh","requestStatuses","canceled","canceling","pending","sent","sending","getObservers","notify","abortNotifier","notifierRemove","notifierNotify","find","notifyActive","notifyResultEvent","notifyStartEvent","reset","requestStatus","subscriptionId","handlePush","push","handler","receive","onSucceed","onError","onTimeout","getPushHandlerMethodGetter","handle","notifierFind","args","getPushHandler","notifierPushHandler","map","pushAbsintheEvent","absintheEvent","channel","absintheEventNames","doc","unsubscribe","createAbsintheUnsubscribeEvent","createAbsintheDocEvent","pushAbsintheDocEvent","requestToCompat","setNotifierRequestStatusSending","createRequestError","message","Error","JSON","stringify","object","notifierNotifyActive","errorMessage","getNotifierPushHandler","pushRequestUsing","onUnsubscribeSucceedCanceled","notifierFlushCanceled","onUnsubscribeSucceedActive","subscribe","notifierReset","createUnsubscribeError","unsubscribeHandler","notifierNotifyCanceled","pushAbsintheUnsubscribeEvent","onSubscribeSucceed","subscribedNotifier","notifierNotifyStartEvent","onSubscribe","response","errors","gqlErrorsToString","onDataMessage","notifierNotifyResultEvent","dataMessageEventName","isDataMessage","cancelQueryOrMutationSending","notifierCancel","cancelQueryOrMutationIfSending","cancelPending","cancelQueryOrMutation","unsubscribeIfNeeded","cancelNonPendingSubscription","cancelSubscription","cancelActive","operationType","setNotifierRequestStatusSent","onQueryOrMutationSucceed","pushQueryOrMutation","pushRequest","createChannelJoinError","notifyErrorToAllActive","createChannelJoinHandler","joinChannel","join","channelJoinCreated","onMessage","withSubscription","createConnectionCloseError","notifyConnectionCloseError","notifierOnConnectionCloseCanceled","notifierOnConnectionCloseActive","notifierOnConnectionClose","onConnectionClose","shouldJoinChannel","onConnectionOpen","absintheChannelName","create","phoenixSocket","onOpen","onClose","observe","notifierObserve","createUsing","getOperationType","operation","reactivate","connectOrJoinChannel","isConnected","connect","sendNew","notifierCreate","append","updateCanceledReactivate","notifierReactivate","updateCanceled","updateIfCanceled","getExistentIfAny","send","getUnsubscriber","onResult","observableObserver","next","complete","createObserver","handlers","onAbort","bind","toObservable","Observable","removeObserver","indexOf","unobserve","ensureHasActiveObserver","includes","notifierUnobserve","doUnobserveOrCancel","unobserveOrCancel"],"mappings":"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"}